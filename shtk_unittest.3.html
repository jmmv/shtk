<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Shell Tookit (shtk)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="styles.css">
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
        <a class="navbar-brand" href="index.html">shtk</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="https://github.com/jmmv/shtk/releases/" target="_blank">Download</a>
            </li>
            <li class="nav-item">
              <a class="nav-link " href="install.html">Installation</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="docs.html">Documentation</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container my-5">
      <div class="row">
        <div class="col px-0">
<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Copyright 2014 Google Inc.
   All rights reserved.
  
   Redistribution and use in source and binary forms, with or without
   modification, are permitted provided that the following conditions are
   met:
  
   * Redistributions of source code must retain the above copyright
     notice, this list of conditions and the following disclaimer.
   * Redistributions in binary form must reproduce the above copyright
     notice, this list of conditions and the following disclaimer in the
     documentation and/or other materials provided with the distribution.
   * Neither the name of Google Inc. nor the names of its contributors
     may be used to endorse or promote products derived from this software
     without specific prior written permission.
  
   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
   "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
   A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
   OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
   SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
   LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
   DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
   THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
   (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
   OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 -->
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>SHTK_UNITTEST(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">SHTK_UNITTEST(3)</td>
    <td class="head-vol">Library Functions Manual</td>
    <td class="head-rtitle">SHTK_UNITTEST(3)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><code class="Nm">unittest</code> &#x2014;
    <span class="Nd">Utilities to implement test programs</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="LIBRARY"><a class="permalink" href="#LIBRARY">LIBRARY</a></h1>
<p class="Pp">shtk_import <code class="Nm">unittest</code></p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">The <code class="Nm">unittest</code> module provides a framework
    with which to implement test programs.</p>
<p class="Pp">A test program implemented with the
    <code class="Nm">unittest</code> library is made up of a combination of
    standalone test cases and/or test cases within test fixtures. The test
    program will exit with 0 (success) if and only if all tests pass, and 1
    (failure) if any single test fails. Skips and expected failures are
    considered passes.</p>
<section class="Ss">
<h2 class="Ss" id="Program_entry_point"><a class="permalink" href="#Program_entry_point">Program
  entry point</a></h2>
<p class="Pp">Test programs implemented using <code class="Nm">unittest</code>
    must use the
    <a class="Xr" href="shtk_unittest_main.3.html">shtk_unittest_main(3)</a>
    function as their entry point. There are two mechanisms to achieve this.</p>
<p class="Pp">The first is to end the test program with the following definition
    of <code class="Nm">main</code>:</p>
<div class="Bd Pp Bd-indent Li">
<pre>main() { shtk_unittest_main &quot;${@}&quot;; }</pre>
</div>
<p class="Pp">The second is to tell <a class="Xr" href="shtk.1.html">shtk(1)</a>
    at build time to use
    <a class="Xr" href="shtk_unittest_main.3.html">shtk_unittest_main(3)</a> as
    the program's entry point:</p>
<div class="Bd Pp Bd-indent Li">
<pre>$ shtk build -m shtk_unittest_main module_test.sh</pre>
</div>
<p class="Pp">In general, prefer the latter mechanism.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Asserts_vs._expects"><a class="permalink" href="#Asserts_vs._expects">Asserts
  vs. expects</a></h2>
<p class="Pp">The <code class="Nm">unittest</code> library provides a variety of
    helper check functions. One such example is the &#x2018;equal&#x2019; check,
    which allows the caller to compare two values for equality and fail the test
    case with the appropriate error message if the values differ.</p>
<p class="Pp" id="assert">Each check is offered in two flavors: an
    <a class="permalink" href="#assert"><i class="Em">assert</i></a> and an
    <a class="permalink" href="#expect"><i class="Em" id="expect">expect</i></a>,
    which in the previous example means we have access to the two corresponding
    functions <code class="Nm">assert_equal</code> and
    <code class="Nm">expect_equal</code>. Assert-style checks are fatal: when
    the condition they test for is not met, the test case is immediately
    aborted; instead, expect-style checks are not fatal: they record the
    currently-running test case as failed but they let the test case continue
    execution. Assert-style checks should be used to validate conditions that
    must hold true in order to run the test (e.g. ensuring that the setup of the
    test case succeeds); expect-style checks should be used for all other
  cases.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Scoping"><a class="permalink" href="#Scoping">Scoping</a></h2>
<p class="Pp">All functions provided by the <code class="Nm">unittest</code>
    library are prefixed by &#x2018;shtk_unittest_&#x2019; as you would expect
    from the coding practices of <code class="Nm">shtk</code>. However, such
    long prefix is inconvenient when writing test programs, as test programs are
    a very special case of scripts in which a domain-specific language makes
    sense.</p>
<p class="Pp">Therefore, for simplicity reasons, test cases have access to
    shortened names of the <code class="Nm">unittest</code> functions without
    the &#x2018;shtk_unittest_&#x2019; prefix. In order words, a test case can
    simply call <code class="Nm">fail</code> instead of having to call
    <code class="Nm">shtk_unittest_fail</code>.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Standalone_test_cases"><a class="permalink" href="#Standalone_test_cases">Standalone
  test cases</a></h2>
<p class="Pp">Standalone test cases are defined by top-level functions whose
    name ends with the &#x2018;_test&#x2019; suffix and are registered as test
    cases with the
    <a class="Xr" href="shtk_unittest_add_test.3.html">shtk_unittest_add_test(3)</a>
    function. Such test cases are run independently of each other, with no
    common setup nor teardown code among them.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Test_fixtures"><a class="permalink" href="#Test_fixtures">Test
  fixtures</a></h2>
<p class="Pp">Test fixtures are collections of related test cases that may share
    optional setup and teardown methods. Test fixtures are defined by top-level
    functions whose name ends with the &#x2018;_fixture&#x2019; suffix and are
    registered as fixtures with the
    <a class="Xr" href="shtk_unittest_add_fixture.3.html">shtk_unittest_add_fixture(3)</a>
    function.</p>
<p class="Pp">Within fixture fuctions, there may be a
    <code class="Nm">setup</code> and a <code class="Nm">teardown</code> method,
    and there should be one or more test cases registered with
    <a class="Xr" href="shtk_unittest_add_test.3.html">shtk_unittest_add_test(3)</a>.
    Each test within the fixture is executed independently of each other, but
    the setup and teardown methods (if any) are also executed with the test.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Test_environment"><a class="permalink" href="#Test_environment">Test
  environment</a></h2>
<p class="Pp">The runtime engine (usually
    <a class="Xr" href="kyua.1.html">kyua(1)</a>) is responsible for executing
    the test program under a controlled directory and with a sanitized
    environment.</p>
<p class="Pp">However, due to the nature of shell-based test programs,
    <code class="Nm">unittest</code> creates one extra directory for each test
    case, and such directory becomes the work directory of the test case. These
    directories are all created within the directory in which the test program
    was executed. To ensure that any files created by the test case remain
    within its own subdirectory as much as possible, the
    <var class="Va">HOME</var> and <var class="Va">TMPDIR</var> variables are
    set to point to the individual test's work directory.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="One_time_setup_and_teardown"><a class="permalink" href="#One_time_setup_and_teardown">One
  time setup and teardown</a></h2>
<p class="Pp">Test programs may optionally define top-level
    <code class="Nm">one_time_setup</code> and
    <code class="Nm">one_time_teardown</code>.</p>
<p class="Pp">The code supplied in the <code class="Nm">one_time_setup</code>
    function is executed exactly once at the beginning of the test program and
    all state set up by the function is shared across all tests.</p>
<p class="Pp">The code supplied in the <code class="Nm">one_time_teardown</code>
    function is executed exactly once at the end of the test program and should
    be used to clean up any state prepared by
    <code class="Nm">one_time_setup</code>.</p>
<p class="Pp" id="run">It is important to mention that these one-time setup and
    teardown routines <a class="permalink" href="#run"><i class="Em">run in the
    parent directory of the executed test cases</i></a>. In other words: if the
    setup routine creates any file to be shared across all tests, the tests will
    have access to such files by looking them up in their parent directory.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Test_results"><a class="permalink" href="#Test_results">Test
  results</a></h2>
<p class="Pp">Any test case can complete with one of the following results:</p>
<dl class="Bl-tag">
  <dt>Expected failure (pass)</dt>
  <dd>The test case detected a failure, but such failure is expected. This
      condition is often use to denote test cases that are either incomplete or
      test cases that exercise a known bug. See
      <a class="Xr" href="shtk_unittest_set_expected_failure.3.html">shtk_unittest_set_expected_failure(3)</a>
      for details.</dd>
  <dt>Failure</dt>
  <dd>The test case explicitly failed or it unexpectedly terminated. See
      <a class="Xr" href="shtk_unittest_delayed_fail.3.html">shtk_unittest_delayed_fail(3)</a>
      and
      <a class="Xr" href="shtk_unittest_fail.3.html">shtk_unittest_fail(3)</a>
      for details.</dd>
  <dt>Pass</dt>
  <dd>The test case completed successfully without reporting any errors.</dd>
  <dt>Skip (pass)</dt>
  <dd>The test case determined that it cannot run through completion and decided
      to abort early instead of reporting a false negative. See
      <a class="Xr" href="shtk_unittest_skip.3.html">shtk_unittest_skip(3)</a>
      for details.</dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="EXAMPLES"><a class="permalink" href="#EXAMPLES">EXAMPLES</a></h1>
<p class="Pp">The most basic test program that can be written is the following,
    which provides a simple test case for
    <a class="Xr" href="cp.1.html">cp(1)</a>'s <code class="Fl">-f</code>
  flag:</p>
<div class="Bd Pp Bd-indent Li">
<pre>shtk_import unittest

shtk_unittest_add_test cp_f_forces_override
cp_f_forces_override_test() {
    echo &quot;first&quot; &gt;first
    echo &quot;second&quot; &gt;second
    chmod 555 second

    # First make sure that cp without -f fails.
    assert_command -s exit:1 -e ignore cp first second

    # Now run a second attempt with -f and verify that the command
    # exits successfully and it is silent.
    assert_command cp -f first second

    cmp -s first second || fail &quot;source and destination do not match&quot;
}

main() { shtk_unittest_main &quot;${@}&quot;; }</pre>
</div>
<p class="Pp">A more complex test program can use fixtures to group related test
    cases and to provide common setup and teardown code for each of them:</p>
<div class="Bd Pp Bd-indent Li">
<pre>shtk_import unittest

shtk_unittest_add_fixture cp
    setup() {
        # Create common files used by all test cases.  Note that this runs
        # once per test case, so state is not shared among them.
        echo &quot;first&quot; &gt;first
        echo &quot;second&quot; &gt;second
    }

    teardown() {
        # Common cleanup to be executed at the end of the test case, no
        # matter if it passes or fails.
        rm -f first second
    }

    shtk_unittest_add_test override_existing_file
    override_existing_file_test() {
        assert_command cp first second
        cmp -s first second || fail &quot;source and destination do not match&quot;
    }

    shtk_unittest_add_test f_forces_override
    f_forces_override_test() {
        chmod 555 second
        assert_command -s exit:1 -e ignore cp first second
        assert_command cp -f first second
        cmp -s first second || fail &quot;source and destination do not match&quot;
    }
}

main() { shtk_unittest_main &quot;${@}&quot;; }</pre>
</div>
<p class="Pp">Lastly, the most complex test program is depicted here, which
    includes a combination of fixtures and test cases with one-time setup and
    teardown routines:</p>
<div class="Bd Pp Bd-indent Li">
<pre>shtk_import unittest

one_time_setup() {
    ... initialization code shared by all tests in the program ...
}

one_time_teardown() {
    ... clean up code shared by all tests in the program ...
}

shtk_unittest_add_fixture clients
clients_fixture() {
    setup() {
        ... initialization code shared by all tests in the fixture ...
    }
    teardown() {
        ... cleanup code shared by all tests in the fixture ...
    }

    shtk_unittest_add_test add
    add_test() {
        ... first test in the fixture ...
    }

    shtk_unittest_add_test modify
    modify_test() {
        ... second test in the fixture ...
        fail &quot;And it fails&quot;
    }
}

shtk_unittest_add_test initialization
initialization_test() {
    ... standalone test not part of any fixture ...
    skip &quot;But cannot run due to some unsatisfied condition&quot;
}

# Either do this or, preferably, pass -mshtk_unittest_main to
# &quot;shtk build&quot; when compiling the test program and don't define main.
main() { shtk_unittest_main &quot;${@}&quot;; }</pre>
</div>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><a class="Xr" href="shtk.3.html">shtk(3)</a>,
    <a class="Xr" href="shtk_unittest.1.html">shtk_unittest(1)</a>,
    <a class="Xr" href="shtk_unittest_add_fixture.3.html">shtk_unittest_add_fixture(3)</a>,
    <a class="Xr" href="shtk_unittest_add_test.3.html">shtk_unittest_add_test(3)</a>,
    <a class="Xr" href="shtk_unittest_delayed_fail.3.html">shtk_unittest_delayed_fail(3)</a>,
    <a class="Xr" href="shtk_unittest_fail.3.html">shtk_unittest_fail(3)</a>,
    <a class="Xr" href="shtk_unittest_main.3.html">shtk_unittest_main(3)</a>,
    <a class="Xr" href="shtk_unittest_set_expected_failure.3.html">shtk_unittest_set_expected_failure(3)</a>,
    <a class="Xr" href="shtk_unittest_skip.3.html">shtk_unittest_skip(3)</a></p>
<section class="Ss">
<h2 class="Ss" id="Checks"><a class="permalink" href="#Checks">Checks</a></h2>
<p class="Pp"><a class="Xr" href="shtk_unittest_assert_command.3.html">shtk_unittest_assert_command(3)</a>,
    <a class="Xr" href="shtk_unittest_assert_equal.3.html">shtk_unittest_assert_equal(3)</a>,
    <a class="Xr" href="shtk_unittest_assert_file.3.html">shtk_unittest_assert_file(3)</a>,
    <a class="Xr" href="shtk_unittest_assert_not_equal.3.html">shtk_unittest_assert_not_equal(3)</a>,
    <a class="Xr" href="shtk_unittest_expect_command.3.html">shtk_unittest_expect_command(3)</a>,
    <a class="Xr" href="shtk_unittest_expect_equal.3.html">shtk_unittest_expect_equal(3)</a>,
    <a class="Xr" href="shtk_unittest_expect_file.3.html">shtk_unittest_expect_file(3)</a>,
    <a class="Xr" href="shtk_unittest_expect_not_equal.3.html">shtk_unittest_expect_not_equal(3)</a></p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="HISTORY"><a class="permalink" href="#HISTORY">HISTORY</a></h1>
<p class="Pp"><code class="Nm">unittest</code> first appeared in
    <code class="Nm">shtk</code> 1.6.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">November 16, 2014</td>
    <td class="foot-os">Debian</td>
  </tr>
</table>
</body>
</html>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <script src="main.js"></script>

    <img src="https://hugo-dynamic.jmmv.dev/api/sites/238881e4-4c6d-4bcf-87df-d0fd12afd2ce/pages/aHR0cHM6Ly9zaHRrLmptbXYuZGV2L3NodGtfdW5pdHRlc3QuMy5odG1sCg==/stamp.gif" style="display: none;" />
  </body>
</html>
